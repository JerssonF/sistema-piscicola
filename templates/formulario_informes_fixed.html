<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Informes</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #4a90e2, #357abd);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: white;
      margin-top: 50px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .form-title {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
      font-size: 2rem;
    }
    
    .search-container {
      background: #f8f9fa;
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
    }
    
    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .filter-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 8px;
      color: #495057;
    }
    
    .filter-group select,
    .filter-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 16px;
    }
    
    .search-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #4a90e2, #357abd);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #6c757d, #5a6268);
      color: white;
    }
    
    .results-container {
      margin-top: 2rem;
    }
    
    .results-title {
      color: #495057;
      font-size: 1.3rem;
      margin-bottom: 1rem;
      font-weight: 600;
    }
    
    .results-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
    
    .results-table th {
      background: linear-gradient(135deg, #4a90e2, #357abd);
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
    }
    
    .results-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #e9ecef;
    }
    
    .results-table tr:hover {
      background: #f8f9fa;
    }

    .filters-summary {
      background: #e8f4f8;
      border: 1px solid #bee5eb;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      color: #0c5460;
    }

    .filters-summary h4 {
      margin: 0 0 10px 0;
      color: #0c5460;
      font-size: 1.1rem;
    }

    .filter-tag {
      display: inline-block;
      background: #17a2b8;
      color: white;
      padding: 4px 12px;
      border-radius: 15px;
      margin: 3px 5px 3px 0;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .no-filters {
      color: #6c757d;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="form-title"><i class="fas fa-chart-bar"></i> Sistema de Informes</h2>

    <!-- FILTROS DE B√öSQUEDA -->
    <div class="search-container">
      <h3><i class="fas fa-search"></i> Filtros de B√∫squeda</h3>
      
      <form method="POST" action="{{ url_for('routes.formulario_informes') }}">
        <div class="filters-grid">
          <div class="filter-group">
            <label for="formulario"><i class="fas fa-list"></i> Tipo de Formulario:</label>
            <select name="formulario" id="formulario">
              <option value="">üìã Todos los formularios</option>
              <option value="alimento" {{ 'selected' if formulario_seleccionado == 'alimento' }}>üêü Alimentos</option>
              <option value="ingreso_alimentos" {{ 'selected' if formulario_seleccionado == 'ingreso_alimentos' }}>‚ûï Ingreso de Alimentos</option>
              <option value="muestreo" {{ 'selected' if formulario_seleccionado == 'muestreo' }}>üî¨ Muestreo</option>
              <option value="parametros" {{ 'selected' if formulario_seleccionado == 'parametros' }}>‚öôÔ∏è Par√°metros</option>
              <option value="siembra" {{ 'selected' if formulario_seleccionado == 'siembra' }}>üå± Siembra</option>
            </select>
          </div>

          <div class="filter-group">
            <label for="fecha_desde"><i class="fas fa-calendar-alt"></i> Fecha Desde:</label>
            <input type="date" name="fecha_desde" id="fecha_desde" value="{{ request.form.get('fecha_desde', '') }}">
          </div>

          <div class="filter-group">
            <label for="fecha_hasta"><i class="fas fa-calendar-check"></i> Fecha Hasta:</label>
            <input type="date" name="fecha_hasta" id="fecha_hasta" value="{{ request.form.get('fecha_hasta', '') }}">
          </div>

          <div class="filter-group">
            <label for="estanque"><i class="fas fa-water"></i> Estanque/Celda:</label>
            <input type="text" name="estanque" id="estanque" placeholder="Ej: 1, 2, A, B..." value="{{ request.form.get('estanque', '') }}">
          </div>
        </div>

        <div class="search-buttons">
          <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> Buscar Informaci√≥n</button>
          <button type="button" class="btn btn-secondary" onclick="limpiarFiltros()"><i class="fas fa-eraser"></i> Limpiar Filtros</button>
        </div>
      </form>
    </div>

    <!-- RESULTADOS -->
    {% if resultados and resultados|length > 0 %}
    <div class="results-container">
      <h3 class="results-title"><i class="fas fa-table"></i> Resultados de la B√∫squeda ({{ resultados|length }} registros encontrados)</h3>
      
      <!-- FILTROS APLICADOS -->
      <div class="filters-summary">
        <h4><i class="fas fa-filter"></i> Filtros Aplicados:</h4>
        <div class="applied-filters">
          {% if formulario_seleccionado %}
            <span class="filter-tag">
              <i class="fas fa-list"></i> 
              {% if formulario_seleccionado == 'alimento' %}üêü Alimentos
              {% elif formulario_seleccionado == 'ingreso_alimentos' %}‚ûï Ingreso de Alimentos
              {% elif formulario_seleccionado == 'muestreo' %}üî¨ Muestreo
              {% elif formulario_seleccionado == 'parametros' %}‚öôÔ∏è Par√°metros
              {% elif formulario_seleccionado == 'siembra' %}üå± Siembra
              {% else %}{{ formulario_seleccionado|title }}
              {% endif %}
            </span>
          {% endif %}
          
          {% if request.form.get('fecha_desde') %}
            <span class="filter-tag">
              <i class="fas fa-calendar-alt"></i> Desde: {{ request.form.get('fecha_desde') }}
            </span>
          {% endif %}
          
          {% if request.form.get('fecha_hasta') %}
            <span class="filter-tag">
              <i class="fas fa-calendar-check"></i> Hasta: {{ request.form.get('fecha_hasta') }}
            </span>
          {% endif %}
          
          {% if request.form.get('estanque') %}
            <span class="filter-tag">
              <i class="fas fa-water"></i> Estanque/Celda: {{ request.form.get('estanque') }}
            </span>
          {% endif %}
          
          {% if not formulario_seleccionado and not request.form.get('fecha_desde') and not request.form.get('fecha_hasta') and not request.form.get('estanque') %}
            <span class="no-filters">Sin filtros espec√≠ficos - Mostrando todos los registros</span>
          {% endif %}
        </div>
      </div>
      
      <table class="results-table">
        <thead>
          <tr>
            {% if formulario_seleccionado == 'alimento' %}
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-clock"></i> Frecuencia Toma</th>
              <th><i class="fas fa-map-marker-alt"></i> Estanque/Celda</th>
              <th><i class="fas fa-tag"></i> Referencia Alimento</th>
              <th><i class="fas fa-weight"></i> Cantidad Alimento (kg)</th>
              <th><i class="fas fa-skull-crossbones"></i> Mortalidad</th>
              <th><i class="fas fa-exclamation-triangle"></i> Causa Mortalidad</th>
              <th><i class="fas fa-tools"></i> Acciones Correctivas</th>
            {% elif formulario_seleccionado == 'ingreso_alimentos' %}
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-map-marker-alt"></i> Estanque/Celda</th>
              <th><i class="fas fa-box"></i> Tipo Ingreso</th>
              <th><i class="fas fa-weight"></i> Cantidad (kg)</th>
              <th><i class="fas fa-clock"></i> Hora</th>
              <th><i class="fas fa-truck"></i> Transporte</th>
            {% elif formulario_seleccionado == 'muestreo' %}
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-map-marker-alt"></i> Estanque/Celda</th>
              <th><i class="fas fa-dna"></i> Especie</th>
              <th><i class="fas fa-fish"></i> Peces</th>
              <th><i class="fas fa-weight"></i> Biomasa (kg)</th>
              <th><i class="fas fa-balance-scale"></i> Peso Promedio (g)</th>
            {% elif formulario_seleccionado == 'parametros' %}
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-map-marker-alt"></i> Estanque/Celda</th>
              <th><i class="fas fa-wind"></i> Ox√≠geno</th>
              <th><i class="fas fa-thermometer-half"></i> Temperatura (¬∞C)</th>
              <th><i class="fas fa-flask"></i> pH</th>
              <th><i class="fas fa-vial"></i> Amonio</th>
            {% elif formulario_seleccionado == 'siembra' %}
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-map-marker-alt"></i> Estanque/Celda</th>
              <th><i class="fas fa-dna"></i> Especie</th>
              <th><i class="fas fa-arrow-right"></i> Destino</th>
              <th><i class="fas fa-egg"></i> Ovas/Alevinos</th>
              <th><i class="fas fa-venus-mars"></i> Tipo</th>
            {% else %}
              <th><i class="fas fa-list"></i> Formulario</th>
              <th><i class="fas fa-calendar-alt"></i> Fecha</th>
              <th><i class="fas fa-fish"></i> Estanque/Celda</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% if resultados %}
            {% for registro in resultados %}
            <tr class="main-row">
              {% if formulario_seleccionado == 'alimento' %}
                <td>{{ registro['fecha'].strftime('%d/%m/%Y') if registro['fecha'] else 'N/A' }}</td>
                <td>{{ registro['frecuencia_toma'] or 'N/A' }}</td>
                <td>{{ registro['estanque_celda'] or 'N/A' }}</td>
                <td>{{ registro['referencia_alimento'] or 'N/A' }}</td>
                <td>{{ "{:.2f}".format(registro['cantidad_alimento']) if registro['cantidad_alimento'] else '0.00' }}</td>
                <td>{{ registro['mortalidad'] or '0' }}</td>
                <td>{{ registro['causa_mortalidad'] or 'N/A' }}</td>
                <td>{{ registro['acciones_correctivas'] or 'N/A' }}</td>
              {% elif formulario_seleccionado == 'ingreso_alimentos' %}
                <td>{{ registro['fecha'].strftime('%d/%m/%Y') if registro['fecha'] else 'N/A' }}</td>
                <td>{{ registro['hora'] or 'N/A' }}</td>
                <td>{{ registro['ingreso_comida'] or 'N/A' }}</td>
                <td>{{ "{:.2f}".format(registro['cantidad']) if registro['cantidad'] else '0.00' }}</td>
                <td>{{ registro['transporte'] or 'N/A' }}</td>
                <td>{{ registro['observaciones'] or 'N/A' }}</td>
              {% elif formulario_seleccionado == 'muestreo' %}
                <td>{{ registro['fecha'].strftime('%d/%m/%Y') if registro['fecha'] else 'N/A' }}</td>
                <td>{{ registro['estanque_celda'] or 'N/A' }}</td>
                <td>{{ registro['especie'] or 'N/A' }}</td>
                <td>{{ registro['peces'] or '0' }}</td>
                <td>{{ "{:.2f}".format(registro['biomasa']) if registro['biomasa'] else '0.00' }}</td>
                <td>{{ "{:.2f}".format(registro['peso_promedio_g']) if registro['peso_promedio_g'] else '0.00' }}</td>
              {% elif formulario_seleccionado == 'parametros' %}
                <td>{{ registro['fecha'].strftime('%d/%m/%Y') if registro['fecha'] else 'N/A' }}</td>
                <td>{{ registro['estanque_celda'] or 'N/A' }}</td>
                <td>{{ "{:.2f}".format(registro['oxigeno']) if registro['oxigeno'] else '0.00' }}</td>
                <td>{{ "{:.1f}".format(registro['temperatura']) if registro['temperatura'] else '0.0' }}</td>
                <td>{{ "{:.1f}".format(registro['ph']) if registro['ph'] else '0.0' }}</td>
                <td>{{ "{:.2f}".format(registro['amonio']) if registro['amonio'] else '0.00' }}</td>
              {% elif formulario_seleccionado == 'siembra' %}
                <td>{{ registro['fecha'].strftime('%d/%m/%Y') if registro['fecha'] else 'N/A' }}</td>
                <td>{{ registro['estanque_celda'] or 'N/A' }}</td>
                <td>{{ registro['especie'] or 'N/A' }}</td>
                <td>{{ registro['destino'] or 'N/A' }}</td>
                <td>{{ registro['ovas_alevinos'] or '0' }}</td>
                <td>{{ registro['hembras_machos'] or 'N/A' }}</td>
              {% else %}
                <td>
                  {% if registro['tipo'] == 'alimento' %}<i class="fas fa-fish"></i> Alimentos
                  {% elif registro['tipo'] == 'ingreso_alimentos' %}<i class="fas fa-plus-circle"></i> Ingreso de Alimentos
                  {% elif registro['tipo'] == 'muestreo' %}<i class="fas fa-microscope"></i> Muestreo
                  {% elif registro['tipo'] == 'parametros' %}<i class="fas fa-cogs"></i> Par√°metros
                  {% elif registro['tipo'] == 'siembra' %}<i class="fas fa-seedling"></i> Siembra
                  {% endif %}
                </td>
                <td>{{ registro['fecha'].strftime('%d/%m/%Y') if registro['fecha'] else 'N/A' }}</td>
                <td>{{ registro['estanque_celda'] or 'N/A' }}</td>
              {% endif %}
            </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="8" style="text-align: center; padding: 20px; color: #6c757d;">No se encontraron registros</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="results-container">
      <div style="text-align: center; padding: 40px; color: #666;">
        <i class="fas fa-info-circle" style="font-size: 3rem; margin-bottom: 20px;"></i>
        <p>Realice una b√∫squeda para ver los resultados.</p>
      </div>
    </div>
    {% endif %}
  </div>

  <script>
    function limpiarFiltros() {
      document.getElementById('formulario').value = '';
      document.getElementById('fecha_desde').value = '';
      document.getElementById('fecha_hasta').value = '';
      document.getElementById('estanque').value = '';
    }
  </script>
</body>
</html>
