<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Informes</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #4a90e2, #357abd);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .header {
      background: white;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .form-row {
      display: flex;
      gap: 1rem;
      align-items: end;
      flex-wrap: wrap;
    }
    
    .form-group {
      flex: 1;
      min-width: 200px;
    }
    
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #495057;
    }
    
    select, input[type="date"], input[type="text"] {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    select:focus, input:focus {
      border-color: #4a90e2;
      outline: none;
      box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
    }
    
    .btn-group {
      display: flex;
      gap: 0.5rem;
    }
    
    .btn {
      padding: 0.8rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #4a90e2, #357abd);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #6c757d, #5a6268);
      color: white;
    }
    
    .results-container {
      margin-top: 2rem;
    }
    
    .results-title {
      color: #495057;
      font-size: 1.3rem;
      margin-bottom: 1rem;
      font-weight: 600;
    }
    
    .filters-summary {
      background: #e7f3ff;
      border: 1px solid #b3d9ff;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .filters-title {
      font-weight: 600;
      color: #2c5aa0;
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .filter-tag {
      display: inline-block;
      background: #17a2b8;
      color: white;
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .results-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
    
    .results-table th {
      background: linear-gradient(135deg, #4a90e2, #357abd);
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
    }
    
    .results-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #e9ecef;
    }
    
    .results-table tr:hover {
      background-color: #f8f9fa;
    }
    
    .no-results {
      text-align: center;
      padding: 3rem;
      color: #6c757d;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-chart-bar"></i> Formulario de Informes</h1>
      
      <form method="POST">
        <div class="form-row">
          <div class="form-group">
            <label for="formulario"><i class="fas fa-list"></i> Tipo de Formulario:</label>
            <select name="formulario" id="formulario" required>
              <option value="">Seleccione un formulario</option>
              <option value="alimento" {{ 'selected' if formulario_seleccionado == 'alimento' else '' }}>üêü Alimentos</option>
              <option value="ingreso_alimentos" {{ 'selected' if formulario_seleccionado == 'ingreso_alimentos' else '' }}>‚ûï Ingreso de Alimentos</option>
              <option value="muestreo" {{ 'selected' if formulario_seleccionado == 'muestreo' else '' }}>üî¨ Muestreo</option>
              <option value="parametros" {{ 'selected' if formulario_seleccionado == 'parametros' else '' }}>‚öôÔ∏è Par√°metros</option>
              <option value="siembra" {{ 'selected' if formulario_seleccionado == 'siembra' else '' }}>üå± Siembra</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="fecha_desde"><i class="fas fa-calendar"></i> Fecha Desde:</label>
            <input type="date" name="fecha_desde" id="fecha_desde" value="{{ request.form.get('fecha_desde', '') }}">
          </div>
          
          <div class="form-group">
            <label for="fecha_hasta"><i class="fas fa-calendar-check"></i> Fecha Hasta:</label>
            <input type="date" name="fecha_hasta" id="fecha_hasta" value="{{ request.form.get('fecha_hasta', '') }}">
          </div>
          
          <div class="form-group">
            <label for="estanque"><i class="fas fa-water"></i> Estanque/Celda:</label>
            <input type="text" name="estanque" id="estanque" placeholder="Ej: 1, 2, A, B..." value="{{ request.form.get('estanque', '') }}">
          </div>
          
          <div class="btn-group">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-search"></i> Buscar Informaci√≥n
            </button>
            <a href="{{ url_for('routes.formulario_informes') }}" class="btn btn-secondary">
              <i class="fas fa-eraser"></i> Limpiar Filtros
            </a>
          </div>
        </div>
      </form>
    </div>

    <!-- DEBUG Y RESULTADOS -->
    {% if resultados and resultados|length > 0 %}
    
    <!-- DEBUG INFO CON FONDO AMARILLO -->
    <div style="background: yellow; border: 2px solid #ff6600; padding: 15px; margin: 10px; border-radius: 5px;">
      <h4>üîç DEBUG INFO:</h4>
      <p><strong>Resultados encontrados:</strong> {{ resultados|length }}</p>
      <p><strong>Formulario seleccionado:</strong> "{{ formulario_seleccionado }}"</p>
      <p><strong>Primer registro:</strong> {{ resultados[0] }}</p>
    </div>
    
    <div class="results-container">
      <h2 class="results-title">
        <i class="fas fa-table"></i> Resultados de la B√∫squeda ({{ resultados|length }} registros encontrados)
      </h2>
      
      <div class="filters-summary">
        <div class="filters-title">
          <i class="fas fa-filter"></i> Filtros Aplicados:
        </div>
        
        {% if formulario_seleccionado %}
          <span class="filter-tag">
            <i class="fas fa-list"></i> 
            {% if formulario_seleccionado == 'alimento' %}üêü Alimentos
            {% elif formulario_seleccionado == 'ingreso_alimentos' %}‚ûï Ingreso de Alimentos
            {% elif formulario_seleccionado == 'muestreo' %}üî¨ Muestreo
            {% elif formulario_seleccionado == 'parametros' %}‚öôÔ∏è Par√°metros
            {% elif formulario_seleccionado == 'siembra' %}üå± Siembra
            {% endif %}
          </span>
        {% endif %}
        
        {% if request.form.get('fecha_desde') %}
          <span class="filter-tag">
            <i class="fas fa-calendar"></i> Desde: {{ request.form.get('fecha_desde') }}
          </span>
        {% endif %}
        
        {% if request.form.get('fecha_hasta') %}
          <span class="filter-tag">
            <i class="fas fa-calendar-check"></i> Hasta: {{ request.form.get('fecha_hasta') }}
          </span>
        {% endif %}
        
        {% if request.form.get('estanque') %}
          <span class="filter-tag">
            <i class="fas fa-water"></i> Estanque/Celda: {{ request.form.get('estanque') }}
          </span>
        {% endif %}
      </div>

      <table class="results-table">
        <thead>
          <tr>
            {% if formulario_seleccionado == 'alimento' %}
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-clock"></i> Frecuencia Toma</th>
              <th><i class="fas fa-map-marker-alt"></i> Estanque/Celda</th>
              <th><i class="fas fa-tag"></i> Referencia Alimento</th>
              <th><i class="fas fa-weight"></i> Cantidad Alimento (kg)</th>
              <th><i class="fas fa-skull-crossbones"></i> Mortalidad</th>
              <th><i class="fas fa-exclamation-triangle"></i> Causa Mortalidad</th>
              <th><i class="fas fa-tools"></i> Acciones Correctivas</th>
            {% elif formulario_seleccionado == 'ingreso_alimentos' %}
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-clock"></i> Hora</th>
              <th><i class="fas fa-utensils"></i> Ingreso Comida</th>
              <th><i class="fas fa-weight"></i> Cantidad (kg)</th>
              <th><i class="fas fa-truck"></i> Transporte</th>
              <th><i class="fas fa-sticky-note"></i> Observaciones</th>
            {% elif formulario_seleccionado == 'muestreo' %}
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-map-marker-alt"></i> Estanque/Celda</th>
              <th><i class="fas fa-fish"></i> Especie</th>
              <th><i class="fas fa-hashtag"></i> Peces</th>
              <th><i class="fas fa-weight"></i> Biomasa (kg)</th>
              <th><i class="fas fa-balance-scale"></i> Peso Promedio (g)</th>
            {% elif formulario_seleccionado == 'parametros' %}
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-map-marker-alt"></i> Estanque/Celda</th>
              <th><i class="fas fa-air-freshener"></i> Ox√≠geno</th>
              <th><i class="fas fa-thermometer-half"></i> Temperatura (¬∞C)</th>
              <th><i class="fas fa-vial"></i> pH</th>
              <th><i class="fas fa-flask"></i> Amonio</th>
            {% elif formulario_seleccionado == 'siembra' %}
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-map-marker-alt"></i> Estanque/Celda</th>
              <th><i class="fas fa-fish"></i> Especie</th>
              <th><i class="fas fa-map-pin"></i> Destino</th>
              <th><i class="fas fa-egg"></i> Ovas/Alevinos</th>
              <th><i class="fas fa-venus-mars"></i> Hembras/Machos</th>
            {% else %}
              <th><i class="fas fa-list"></i> Tipo</th>
              <th><i class="fas fa-calendar"></i> Fecha</th>
              <th><i class="fas fa-fish"></i> Estanque/Celda</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% if resultados %}
            {% for registro in resultados %}
            <tr class="main-row">
              {% if formulario_seleccionado == 'alimento' %}
                <td>{{ registro['fecha'] }}</td>
                <td>{{ registro['frecuencia_toma'] }}</td>
                <td>{{ registro['estanque_celda'] }}</td>
                <td>{{ registro['referencia_alimento'] }}</td>
                <td>{{ registro['cantidad_alimento'] }}</td>
                <td>{{ registro['mortalidad'] }}</td>
                <td>{{ registro['causa_mortalidad'] }}</td>
                <td>{{ registro['acciones_correctivas'] }}</td>
              {% elif formulario_seleccionado == 'ingreso_alimentos' %}
                <td>{{ registro['fecha'] }}</td>
                <td>{{ registro['hora'] }}</td>
                <td>{{ registro['ingreso_comida'] }}</td>
                <td>{{ registro['cantidad'] }}</td>
                <td>{{ registro['transporte'] }}</td>
                <td>{{ registro['observaciones'] }}</td>
              {% elif formulario_seleccionado == 'muestreo' %}
                <td>{{ registro['fecha'] }}</td>
                <td>{{ registro['estanque_celda'] }}</td>
                <td>{{ registro['especie'] }}</td>
                <td>{{ registro['peces'] }}</td>
                <td>{{ registro['biomasa'] }}</td>
                <td>{{ registro['peso_promedio_g'] }}</td>
              {% elif formulario_seleccionado == 'parametros' %}
                <td>{{ registro['fecha'] }}</td>
                <td>{{ registro['estanque_celda'] }}</td>
                <td>{{ registro['oxigeno'] }}</td>
                <td>{{ registro['temperatura'] }}</td>
                <td>{{ registro['ph'] }}</td>
                <td>{{ registro['amonio'] }}</td>
              {% elif formulario_seleccionado == 'siembra' %}
                <td>{{ registro['fecha'] }}</td>
                <td>{{ registro['estanque_celda'] }}</td>
                <td>{{ registro['especie'] }}</td>
                <td>{{ registro['destino'] }}</td>
                <td>{{ registro['ovas_alevinos'] }}</td>
                <td>{{ registro['hembras_machos'] }}</td>
              {% else %}
                <td>{{ registro['tipo'] }}</td>
                <td>{{ registro['fecha'] }}</td>
                <td>{{ registro['estanque_celda'] }}</td>
              {% endif %}
            </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="8" style="text-align: center; padding: 20px; color: #6c757d;">No se encontraron registros</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
    {% endif %}
  </div>
</body>
</html>
